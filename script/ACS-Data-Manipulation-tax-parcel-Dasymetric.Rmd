---
title: "ACS-Data-Manipulation-tax-parcel-Dasymetric"
author: "Bowen He"
date: "3/1/2021"
output: html_document
---

```{r acs-data-manipulation-setup, include=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidycensus)
library(sf)
library(dplyr)
library(tidyverse)
library(gt)
library(tiff)
library(raster)

setwd("/Users/hebowen/Desktop/MarTREC_project/Data")
```

In this document, we integrate ACS data and calculate the social fabric index for each census tract for the year of 2010 and 2018.

## Demographic Diversity (#demographic)

Her we import the indicators ingredients ACS data associated with demographic diversity dimension, manipulated data and calculated.

### The year of 2010 (#2010)
#### Population (#pop-2010)
```{r pop-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/pop")
population_2010 <- readRDS('dasy_pop_parcel_2010.Rds')
#plot(population_2010)
# calculate the mean and standard deviation of the population
population_2010_df <- population_2010$dasy_pop_parcel_2010

mean_pop_2010_LA <- mean(population_2010_df$dasy_pop_LA, na.rm = TRUE)
std_pop_2010_LA <- sd(population_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_pop_2010_DU <- mean(population_2010_df$dasy_pop_DU, na.rm = TRUE)
std_pop_2010_DU <- sd(population_2010_df$dasy_pop_DU, na.rm = TRUE)

population_2010_df <- population_2010_df %>%
  mutate(z_pop_2010_LA = (dasy_pop_LA - mean_pop_2010_LA)/std_pop_2010_LA, z_pop_2010_DU = (dasy_pop_DU - mean_pop_2010_DU)/std_pop_2010_DU)
```

#### African American (#african-american-2010)
```{r african-american-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/africa-america")
african_american_2010 <- readRDS('dasy_black_pop_parcel_2010.Rds')
#plot(african_american_2010)
# calculate the mean and standard deviation of the population
african_american_2010_df <- african_american_2010$dasy_black_pop_parcel_2010

mean_african_american_2010_LA <- mean(african_american_2010_df$dasy_pop_LA, na.rm = TRUE)
std_african_american_2010_LA <- sd(african_american_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_african_american_2010_DU <- mean(african_american_2010_df$dasy_pop_DU, na.rm = TRUE)
std_african_american_2010_DU <- sd(african_american_2010_df$dasy_pop_DU, na.rm = TRUE)

african_american_2010_df <- african_american_2010_df %>%
  mutate(z_african_american_2010_LA = (dasy_pop_LA - mean_african_american_2010_LA)/std_african_american_2010_LA, z_african_american_2010_DU = (dasy_pop_DU - mean_african_american_2010_DU)/std_african_american_2010_DU)
```

#### Disable Population (#disable-pop-2010)
```{r disable-pop-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/disable-pop")
disable_pop_2010 <- readRDS('dasy_disable_pop_parcel_2010.Rds')
#plot(disable_pop_2010)
# calculate the mean and standard deviation of the population
disable_pop_2010_df <- disable_pop_2010$dasy_disable_pop_parcel_2010

mean_disable_pop_2010_LA <- mean(disable_pop_2010_df$dasy_pop_LA, na.rm = TRUE)
std_disable_pop_2010_LA <- sd(disable_pop_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_disable_pop_2010_DU <- mean(disable_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
std_disable_pop_2010_DU <- sd(disable_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

disable_pop_2010_df <-disable_pop_2010_df %>%
  mutate(z_disable_pop_2010_LA = (dasy_pop_LA - mean_disable_pop_2010_LA)/std_disable_pop_2010_LA, z_disable_pop_2010_DU = (dasy_pop_DU - mean_disable_pop_2010_DU)/std_disable_pop_2010_DU)
```

#### Family Own Children (#family-own-children-2010)

```{r family-own-children-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/family-own-children")
family_own_children_2010 <- readRDS('dasy_family_own_children_parcel_2010.Rds')

family_own_children_2010_df <- family_own_children_2010$dasy_family_own_children_parcel_2010

mean_family_own_children_2010_LA <- mean(family_own_children_2010_df$dasy_pop_LA, na.rm = TRUE)
std_family_own_children_2010_LA <- sd(family_own_children_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_family_own_children_2010_DU <- mean(family_own_children_2010_df$dasy_pop_DU, na.rm = TRUE)
std_family_own_children_2010_DU <- sd(family_own_children_2010_df$dasy_pop_DU, na.rm = TRUE)

family_own_children_2010_df <-family_own_children_2010_df %>%
  mutate(z_family_own_children_2010_LA = (dasy_pop_LA - mean_family_own_children_2010_LA)/std_family_own_children_2010_LA, z_family_own_children_2010_DU = (dasy_pop_DU - mean_family_own_children_2010_DU)/std_family_own_children_2010_DU)
```

#### Female population (#female-pop-2010)

```{r female-pop-2010, include=FALSE, message=FALSE, warning=FALSE}
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/female-pop")
female_pop_2010 <- readRDS('dasy_female_pop_parcel_2010.Rds')

# calculate the mean and standard deviation of the population
female_pop_2010_df <- female_pop_2010$dasy_female_pop_parcel_2010

mean_female_pop_2010_LA <- mean(female_pop_2010_df$dasy_pop_LA, na.rm = TRUE)
std_female_pop_2010_LA <- sd(female_pop_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_female_pop_2010_DU <- mean(female_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
std_female_pop_2010_DU <- sd(female_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

female_pop_2010_df <-female_pop_2010_df %>%
  mutate(z_female_pop_2010_LA = (dasy_pop_LA - mean_female_pop_2010_LA)/std_female_pop_2010_LA, z_female_pop_2010_DU = (dasy_pop_DU - mean_female_pop_2010_DU)/std_female_pop_2010_DU)
```

#### Hispanic (#hispanic-2010)
```{r hispanic-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/hispanic")
hispanic_2010 <- readRDS('dasy_hispanic_pop_parcel_2010.Rds')

# calculate the mean and standard deviation of the population
hispanic_2010_df <- hispanic_2010$dasy_hispanic_pop_parcel_2010

mean_hispanic_2010_LA <- mean(hispanic_2010_df$dasy_pop_LA, na.rm = TRUE)
std_hispanic_2010_LA <- sd(hispanic_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_hispanic_2010_DU <- mean(hispanic_2010_df$dasy_pop_DU, na.rm = TRUE)
std_hispanic_2010_DU <- sd(hispanic_2010_df$dasy_pop_DU, na.rm = TRUE)

hispanic_2010_df <-hispanic_2010_df %>%
  mutate(z_hispanic_2010_LA = (dasy_pop_LA - mean_hispanic_2010_LA)/std_hispanic_2010_LA, z_hispanic_2010_DU = (dasy_pop_DU - mean_hispanic_2010_DU)/std_hispanic_2010_DU)
```

#### Household senior (#household-senior-2010)
```{r household-senior-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/household-senior")
household_senior_2010 <- readRDS('dasy_household_senior_parcel_2010.Rds')
# calculate the mean and standard deviation of the population

household_senior_2010_df <- household_senior_2010$dasy_household_senior_parcel_2010

mean_household_senior_2010_LA <- mean(household_senior_2010_df$dasy_pop_LA, na.rm = TRUE)
std_household_senior_2010_LA <- sd(household_senior_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_household_senior_2010_DU <- mean(household_senior_2010_df$dasy_pop_DU, na.rm = TRUE)
std_household_senior_2010_DU <- sd(household_senior_2010_df$dasy_pop_DU, na.rm = TRUE)


household_senior_2010_df <- household_senior_2010_df %>%
  mutate(z_household_senior_2010_LA = (dasy_pop_LA - mean_household_senior_2010_LA)/std_household_senior_2010_LA, z_household_senior_2010_DU = (dasy_pop_DU - mean_household_senior_2010_DU)/std_household_senior_2010_DU)
```

#### Limit Education Attain (#limit-education-attain-2010)
```{r limit-education-attain-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/limit-education-attain")
limit_education_attain_2010 <- readRDS('dasy_limit_education_attain_parcel_2010.Rds')

# calculate the mean and standard deviation of the population
limit_education_attain_2010_df <- limit_education_attain_2010$dasy_limit_education_attain_pop_parcel_2010

mean_limit_education_attain_2010_LA <- mean(limit_education_attain_2010_df$dasy_pop_LA, na.rm = TRUE)
std_limit_education_attain_2010_LA <- sd(limit_education_attain_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_limit_education_attain_2010_DU <- mean(limit_education_attain_2010_df$dasy_pop_DU, na.rm = TRUE)
std_limit_education_attain_2010_DU <- sd(limit_education_attain_2010_df$dasy_pop_DU, na.rm = TRUE)

limit_education_attain_2010_df <- limit_education_attain_2010_df %>%
  mutate(z_limit_education_attain_2010_LA = (dasy_pop_LA - mean_limit_education_attain_2010_LA)/std_limit_education_attain_2010_LA, z_limit_education_attain_2010_DU = (dasy_pop_DU - mean_limit_education_attain_2010_DU)/std_limit_education_attain_2010_DU)
```

#### Male Population (#male-pop-2010)
```{r male-pop-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/male-pop")
male_pop_2010 <- readRDS('dasy_male_pop_parcel_2010.Rds')

male_pop_2010_df <- male_pop_2010$dasy_male_pop_parcel_2010

mean_male_pop_2010_LA <- mean(male_pop_2010_df$dasy_pop_LA, na.rm = TRUE)
std_male_pop_2010_LA <- sd(male_pop_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_male_pop_2010_DU <- mean(male_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
std_male_pop_2010_DU <- sd(male_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

male_pop_2010_df <- male_pop_2010_df %>%
  mutate(z_male_pop_2010_LA = (dasy_pop_LA - mean_male_pop_2010_LA)/std_male_pop_2010_LA, z_male_pop_2010_DU = (dasy_pop_DU - mean_male_pop_2010_DU)/std_male_pop_2010_DU)
```

#### Multi-family Housing (#multifamily-2010)
```{r male-pop-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/multi-family-housing")
multifamily_housing_2010 <- readRDS('dasy_multi_family_housing_parcel_2010.Rds')

multifamily_housing_2010_df <- multifamily_housing_2010$dasy_multi_family_housing_parcel_2010

mean_multifamily_housing_2010_LA <- mean(multifamily_housing_2010_df$dasy_pop_LA, na.rm = TRUE)
std_multifamily_housing_2010_LA <- sd(multifamily_housing_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_multifamily_housing_2010_DU <- mean(multifamily_housing_2010_df$dasy_pop_DU, na.rm = TRUE)
std_multifamily_housing_2010_DU <- sd(multifamily_housing_2010_df$dasy_pop_DU, na.rm = TRUE)

multifamily_housing_2010_df <- multifamily_housing_2010_df %>%
  mutate(z_multifamily_housing_2010_LA = (dasy_pop_LA - mean_multifamily_housing_2010_LA)/std_multifamily_housing_2010_LA, z_multifamily_housing_2010_DU = (dasy_pop_DU - mean_multifamily_housing_2010_DU)/std_multifamily_housing_2010_DU)
```

#### Poverty (#poverty-2010)
```{r poverty-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/poverty")
poverty_2010 <- readRDS('dasy_poverty_parcel_2010.Rds')

poverty_2010_df <- poverty_2010$dasy_poverty_pop_parcel_2010

mean_poverty_2010_LA <- mean(poverty_2010_df$dasy_pop_LA, na.rm = TRUE)
std_poverty_2010_LA <- sd(poverty_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_poverty_2010_DU <- mean(poverty_2010_df$dasy_pop_DU, na.rm = TRUE)
std_poverty_2010_DU <- sd(poverty_2010_df$dasy_pop_DU, na.rm = TRUE)

poverty_2010_df <- poverty_2010_df %>%
  mutate(z_poverty_2010_LA = (dasy_pop_LA - mean_poverty_2010_LA)/std_poverty_2010_LA, z_poverty_2010_DU = (dasy_pop_DU - mean_poverty_2010_LA)/std_poverty_2010_DU)
```

#### Single-parent Family 2010 (#single-parent-family-2010)
```{r single-parent-family-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/single-parent-family")

single_parent_family_2010 <- readRDS('dasy_single_parent_family_parcel_2010.Rds')

single_parent_family_2010_df <- single_parent_family_2010$dasy_single_parent_family_parcel_2010

mean_single_parent_family_2010_LA <- mean(single_parent_family_2010_df$dasy_pop_LA, na.rm = TRUE)
std_single_parent_family_2010_LA <- sd(single_parent_family_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_single_parent_family_2010_DU <- mean(single_parent_family_2010_df$dasy_pop_DU, na.rm = TRUE)
std_single_parent_family_2010_DU <- sd(single_parent_family_2010_df$dasy_pop_DU, na.rm = TRUE)

single_parent_family_2010_df <- single_parent_family_2010_df %>%
  mutate(z_single_parent_family_2010_LA = (dasy_pop_LA - mean_single_parent_family_2010_LA)/std_single_parent_family_2010_LA, z_single_parent_family_2010_DU = (dasy_pop_DU - mean_single_parent_family_2010_DU)/std_single_parent_family_2010_DU)
```

#### Single-person Household (#single-person-household-2010)
```{r single-person-household-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/single-person-household")
single_person_household_2010 <- readRDS('dasy_single_person_household_parcel_2010.Rds')

single_person_household_2010_df <- single_person_household_2010$dasy_single_person_household_parcel_2010

mean_single_person_household_2010_LA <- mean(single_person_household_2010_df$dasy_pop_LA, na.rm = TRUE)
std_single_person_household_2010_LA <- sd(single_person_household_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_single_person_household_2010_DU <- mean(single_person_household_2010_df$dasy_pop_DU, na.rm = TRUE)
std_single_person_household_2010_DU <- sd(single_person_household_2010_df$dasy_pop_DU, na.rm = TRUE)

single_person_household_2010_df <- single_person_household_2010_df %>%
  mutate(z_single_person_household_2010_LA = (dasy_pop_LA - mean_single_person_household_2010_LA)/std_single_person_household_2010_LA, z_single_person_household_2010_DU = (dasy_pop_DU - mean_single_person_household_2010_DU)/std_single_person_household_2010_DU)
```

#### Total Household (#total-household-2010)
```{r total-household-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/total-household")
total_household_2010 <- readRDS('dasy_total_household_parcel_2010.Rds')

# calculate the mean and standard deviation of the population
total_household_2010_df <- total_household_2010$dasy_total_household_parcel_2010

mean_total_household_2010_LA <- mean(total_household_2010_df$dasy_pop_LA, na.rm = TRUE)
std_total_household_2010_LA <- sd(total_household_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_total_household_2010_DU <- mean(total_household_2010_df$dasy_pop_DU, na.rm = TRUE)
std_total_household_2010_DU <- sd(total_household_2010_df$dasy_pop_DU, na.rm = TRUE)


total_household_2010_df <- total_household_2010_df %>%
  mutate(z_total_household_2010_LA = (dasy_pop_LA - mean_total_household_2010_LA)/std_total_household_2010_LA, z_total_household_2010_DU = (dasy_pop_DU - mean_total_household_2010_DU)/std_total_household_2010_DU)
```

#### Total Housing Units (#total-housing-units-2010)
```{r total-housing-units-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/total-housing-units")
total_housing_units_2010 <- readRDS('dasy_total_housing_units_parcel_2010.Rds')
  
# calculate the mean and standard deviation of the population
total_housing_units_2010_df <- total_housing_units_2010$dasy_total_housing_units_parcel_2010

mean_total_housing_units_2010_LA <- mean(total_housing_units_2010_df$dasy_pop_LA, na.rm = TRUE)
std_total_housing_units_2010_LA <- sd(total_housing_units_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_total_housing_units_2010_DU <- mean(total_housing_units_2010_df$dasy_pop_DU, na.rm = TRUE)
std_total_housing_units_2010_DU <- sd(total_housing_units_2010_df$dasy_pop_DU, na.rm = TRUE)

total_housing_units_2010_df <- total_housing_units_2010_df %>%
  mutate(z_total_housing_units_2010_LA = (dasy_pop_LA - mean_total_housing_units_2010_LA)/std_total_housing_units_2010_LA, z_total_housing_units_2010_DU = (dasy_pop_DU - mean_total_housing_units_2010_DU)/std_total_housing_units_2010_DU)
```

#### White Only (#white-only-2010)
```{r white-only-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/white")
white_only_2010 <- readRDS('dasy_white_pop_parcel_2010.Rds')

white_only_2010_df <- white_only_2010$dasy_white_pop_parcel_2010

mean_white_only_2010_LA <- mean(white_only_2010_df$dasy_pop_LA, na.rm = TRUE)
std_white_only_2010_LA <- sd(white_only_2010_df$dasy_pop_LA, na.rm = TRUE)

mean_white_only_2010_DU <- mean(white_only_2010_df$dasy_pop_DU, na.rm = TRUE)
std_white_only_2010_DU <- sd(white_only_2010_df$dasy_pop_DU, na.rm = TRUE)

white_only_2010_df <- white_only_2010_df %>%
  mutate(z_white_only_2010_LA = (dasy_pop_LA - mean_white_only_2010_LA)/std_white_only_2010_LA, z_white_only_2010_DU = (dasy_pop_DU - mean_white_only_2010_DU)/std_white_only_2010_DU)
```

## Build the variables dataframe (#build-df-2010)

Here, we incorporate all the variables and build the dataframe which contains all the variable's z score, geometry information in one dataframe, preparing for principal component analysis. Variables information are sourced from those listed dataframes: (1) population; (2) male population; (3) female population; (4) disable population; (5) african american population; (6) hispanic population; (7) white population; (8) poverty population; (9) limit education attain population; (10) single parent family; (11) single person household; (12) household with senior; (13) multifamily housing units; (14) total housing units; (15) total household; (16) single parent family

```{r build-variable-df, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
variable_df_2010_LA <- population_2010_df %>% dplyr::select ("STANPAR","GEOID", "z_pop_2010_LA" ) %>% st_drop_geometry() %>%
  left_join(white_only_2010_df %>% dplyr::select("STANPAR", "z_white_only_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(male_pop_2010_df %>% dplyr::select("STANPAR", "z_male_pop_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(female_pop_2010_df %>% dplyr::select("STANPAR", "z_female_pop_2010_LA") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(disable_pop_2010_df %>% dplyr::select("STANPAR", "z_disable_pop_2010_LA") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(african_american_2010_df %>% dplyr::select("STANPAR", "z_african_american_2010_LA") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(hispanic_2010_df %>% dplyr::select("STANPAR", "z_hispanic_2010_LA") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(family_own_children_2010_df %>% dplyr::select("STANPAR", "z_family_own_children_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(total_household_2010_df %>% dplyr:: select("STANPAR", "z_total_household_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(single_parent_family_2010_df %>% dplyr::select("STANPAR", "z_single_parent_family_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(total_housing_units_2010_df %>% dplyr::select("STANPAR", "z_total_housing_units_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(single_person_household_2010_df %>% dplyr::select("STANPAR", "z_single_person_household_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(multifamily_housing_2010_df %>% dplyr::select("STANPAR", "z_multifamily_housing_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(household_senior_2010_df %>% dplyr::select("STANPAR", "z_household_senior_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(poverty_2010_df %>% dplyr::select("STANPAR", "z_poverty_2010_LA") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(limit_education_attain_2010_df %>% dplyr::select("STANPAR", "z_limit_education_attain_2010_LA") %>% st_drop_geometry(), by = "STANPAR")

variable_df_2010_DU <- population_2010_df %>% dplyr::select ("STANPAR", "GEOID", "z_pop_2010_DU" ) %>% st_drop_geometry() %>%
  left_join(white_only_2010_df %>% dplyr::select("STANPAR", "z_white_only_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(male_pop_2010_df %>% dplyr::select("STANPAR", "z_male_pop_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(female_pop_2010_df %>% dplyr::select("STANPAR", "z_female_pop_2010_DU") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(disable_pop_2010_df %>% dplyr::select("STANPAR", "z_disable_pop_2010_DU") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(african_american_2010_df %>% dplyr::select("STANPAR", "z_african_american_2010_DU") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(hispanic_2010_df %>% dplyr::select("STANPAR", "z_hispanic_2010_DU") %>% st_drop_geometry(), by = "STANPAR")%>%
  left_join(family_own_children_2010_df %>% dplyr::select("STANPAR", "z_family_own_children_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(total_household_2010_df %>% dplyr:: select("STANPAR", "z_total_household_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(single_parent_family_2010_df %>% dplyr::select("STANPAR", "z_single_parent_family_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(total_housing_units_2010_df %>% dplyr::select("STANPAR", "z_total_housing_units_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(single_person_household_2010_df %>% dplyr::select("STANPAR", "z_single_person_household_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(multifamily_housing_2010_df %>% dplyr::select("STANPAR", "z_multifamily_housing_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(household_senior_2010_df %>% dplyr::select("STANPAR", "z_household_senior_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(poverty_2010_df %>% dplyr::select("STANPAR", "z_poverty_2010_DU") %>% st_drop_geometry(), by = "STANPAR") %>%
  left_join(limit_education_attain_2010_df %>% dplyr::select("STANPAR", "z_limit_education_attain_2010_DU") %>% st_drop_geometry(), by = "STANPAR")
```
#-------------------------------------------------------------------------------------------------------------------------------
### The year of 2018 (#2018)
#### Population (#pop-2018)
```{r pop-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/pop")
population_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/pop/dasy_population_pb_2018.Rds')
#plot(population_2010)
# calculate the mean and standard deviation of the population
population_2018_df <- population_2018$dasy_pop_pb_2018

mean_pop_2018_LA <- mean(population_2018_df$dasy_pop_LA, na.rm = TRUE)
std_pop_2018_LA <- sd(population_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_pop_2010_DU <- mean(population_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_pop_2010_DU <- sd(population_2010_df$dasy_pop_DU, na.rm = TRUE)

population_2018_df <- population_2018_df %>%
  mutate(z_pop_2018_LA = (dasy_pop_LA - mean_pop_2018_LA)/std_pop_2018_LA)
#-------custoum spatial resolution (150 m)-------------------------------
population_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/pop/pop_2018_parcel_grid_150.shp')
mean_pop_2018_150 <- mean(population_2018_150$tot_pop, na.rm = TRUE)
std_pop_2018_150 <- sd(population_2018_150$tot_pop, na.rm = TRUE)

population_2018_150 <- population_2018_150 %>%
  mutate(z_pop_2018 = (tot_pop - mean_pop_2018_150)/std_pop_2018_150)
```

#### African American (#african-american-2018)
```{r african-american-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/africa-america")
african_american_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/africa-america/dasy_black_pop_pb_2018.Rds')
#plot(african_american_2010)
# calculate the mean and standard deviation of the population
african_american_2018_df <- african_american_2018$dasy_black_pop_pb_2018

mean_african_american_2018_LA <- mean(african_american_2018_df$dasy_pop_LA, na.rm = TRUE)
std_african_american_2018_LA <- sd(african_american_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_african_american_2010_DU <- mean(african_american_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_african_american_2010_DU <- sd(african_american_2010_df$dasy_pop_DU, na.rm = TRUE)

african_american_2018_df <- african_american_2018_df %>%
  mutate(z_african_american_2018_LA = (dasy_pop_LA - mean_african_american_2018_LA)/std_african_american_2018_LA)
#-------custoum spatial resolution (150 m)-------------------------------
black_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/africa-america/black_pop_2018_parcel_grid_150.shp')
mean_black_2018_150 <- mean(black_2018_150$tot_pop, na.rm = TRUE)
std_black_2018_150 <- sd(black_2018_150$tot_pop, na.rm = TRUE)

black_2018_150 <- black_2018_150 %>%
  mutate(z_black_2018 = (tot_pop - mean_black_2018_150)/std_black_2018_150)
```

#### Disable Population (#disable-pop-2018)
```{r disable-pop-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/disable-pop")
disable_pop_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/disable-pop/dasy_disable_pop_pb_2018.Rds')
#plot(disable_pop_2010)
# calculate the mean and standard deviation of the population
disable_pop_2018_df <- disable_pop_2018$dasy_disable_pop_pb_2018

mean_disable_pop_2018_LA <- mean(disable_pop_2018_df$dasy_pop_LA, na.rm = TRUE)
std_disable_pop_2018_LA <- sd(disable_pop_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_disable_pop_2010_DU <- mean(disable_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_disable_pop_2010_DU <- sd(disable_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

disable_pop_2018_df <-disable_pop_2018_df %>%
  mutate(z_disable_pop_2018_LA = (dasy_pop_LA - mean_disable_pop_2018_LA)/std_disable_pop_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
disable_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/disable-pop/disable_pop_2018_parcel_grid_150.shp')
mean_disable_2018_150 <- mean(disable_2018_150$tot_pop, na.rm = TRUE)
std_disable_2018_150 <- sd(disable_2018_150$tot_pop, na.rm = TRUE)

disable_2018_150 <- disable_2018_150 %>%
  mutate(z_disable_2018 = (tot_pop - mean_disable_2018_150)/std_disable_2018_150)
```

#### Family Own Children (#family-own-children-2018)
```{r family-own-children-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/family-own-children")
family_own_children_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/family-own-children/dasy_family_own_children_pb_2018.Rds')

family_own_children_2018_df <- family_own_children_2018$dasy_family_own_children_pb_2018

mean_family_own_children_2018_LA <- mean(family_own_children_2018_df$dasy_pop_LA, na.rm = TRUE)
std_family_own_children_2018_LA <- sd(family_own_children_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_family_own_children_2010_DU <- mean(family_own_children_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_family_own_children_2010_DU <- sd(family_own_children_2010_df$dasy_pop_DU, na.rm = TRUE)

family_own_children_2018_df <-family_own_children_2018_df %>%
  mutate(z_family_own_children_2018_LA = (dasy_pop_LA - mean_family_own_children_2018_LA)/std_family_own_children_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
family_own_children_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/family-own-children/family_own_children_2018_parcel_grid_150.shp')
mean_family_own_children_2018_150 <- mean(family_own_children_2018_150$tot_pop, na.rm = TRUE)
std_family_own_children_2018_150 <- sd(family_own_children_2018_150$tot_pop, na.rm = TRUE)

family_own_children_2018_150 <- family_own_children_2018_150 %>%
  mutate(z_family_own_children_2018 = (tot_pop - mean_family_own_children_2018_150)/std_family_own_children_2018_150)
```

#### Female population (#female-pop-2018)

```{r female-pop-2018, include=FALSE, message=FALSE, warning=FALSE}
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/female-pop")
female_pop_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/female-pop/dasy_female_pop_pb_2018.Rds')

# calculate the mean and standard deviation of the population
female_pop_2018_df <- female_pop_2018$dasy_female_pop_pb_2018

mean_female_pop_2018_LA <- mean(female_pop_2018_df$dasy_pop_LA, na.rm = TRUE)
std_female_pop_2018_LA <- sd(female_pop_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_female_pop_2010_DU <- mean(female_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_female_pop_2010_DU <- sd(female_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

female_pop_2018_df <- female_pop_2018_df %>%
  mutate(z_female_pop_2018_LA = (dasy_pop_LA - mean_female_pop_2018_LA)/std_female_pop_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
female_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/female-pop/female_pop_2018_parcel_grid_150.shp')
mean_female_2018_150 <- mean(female_2018_150$tot_pop, na.rm = TRUE)
std_female_2018_150 <- sd(female_2018_150$tot_pop, na.rm = TRUE)

female_2018_150 <- female_2018_150 %>%
  mutate(z_female_2018 = (tot_pop - mean_female_2018_150)/std_female_2018_150)
```

#### Hispanic (#hispanic-2018)
```{r hispanic-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/hispanic")
hispanic_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/hispanic/dasy_hispanic_pop_pb_2018.Rds')

# calculate the mean and standard deviation of the population
hispanic_2018_df <- hispanic_2018$dasy_hispanic_pop_pb_2018
  
mean_hispanic_2018_LA <- mean(hispanic_2018_df$dasy_pop_LA, na.rm = TRUE)
std_hispanic_2018_LA <- sd(hispanic_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_hispanic_2010_DU <- mean(hispanic_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_hispanic_2010_DU <- sd(hispanic_2010_df$dasy_pop_DU, na.rm = TRUE)

hispanic_2018_df <- hispanic_2018_df %>%
  mutate(z_hispanic_2018_LA = (dasy_pop_LA - mean_hispanic_2018_LA)/std_hispanic_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
hispanic_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/hispanic/hispanic_pop_2018_parcel_grid_150.shp')
mean_hispanic_2018_150 <- mean(hispanic_2018_150$tot_pop, na.rm = TRUE)
std_hispanic_2018_150 <- sd(hispanic_2018_150$tot_pop, na.rm = TRUE)

hispanic_2018_150 <- hispanic_2018_150 %>%
  mutate(z_hispanic_2018 = (tot_pop - mean_hispanic_2018_150)/std_hispanic_2018_150)
```

#### Household senior (#household-senior-2018)
```{r household-senior-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
# setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/household-senior")
household_senior_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/household-senior/dasy_household_senior_pb_2018.Rds')
# calculate the mean and standard deviation of the population

household_senior_2018_df <- household_senior_2018$dasy_household_senior_pb_2018

mean_household_senior_2018_LA <- mean(household_senior_2018_df$dasy_pop_LA, na.rm = TRUE)
std_household_senior_2018_LA <- sd(household_senior_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_household_senior_2010_DU <- mean(household_senior_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_household_senior_2010_DU <- sd(household_senior_2010_df$dasy_pop_DU, na.rm = TRUE)

household_senior_2018_df <- household_senior_2018_df %>%
  mutate(z_household_senior_2018_LA = (dasy_pop_LA - mean_household_senior_2018_LA)/std_household_senior_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
household_senior_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/household-senior/senior_household_2018_parcel_grid_150.shp')
mean_household_senior_2018_150 <- mean(household_senior_2018_150$tot_pop, na.rm = TRUE)
std_household_senior_2018_150 <- sd(household_senior_2018_150$tot_pop, na.rm = TRUE)

household_senior_2018_150 <- household_senior_2018_150 %>%
  mutate(z_household_senior_2018 = (tot_pop - mean_household_senior_2018_150)/std_household_senior_2018_150)
```

#### Limit Education Attain (#limit-education-attain-2018)
```{r limit-education-attain-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/limit-education-attain")
limit_education_attain_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/limit-education-attain/dasy_limit_education_attain_pop_pb_2018.Rds')

# calculate the mean and standard deviation of the population
limit_education_attain_2018_df <- limit_education_attain_2018$dasy_limit_education_attain_pop_pb_2018

mean_limit_education_attain_2018_LA <- mean(limit_education_attain_2018_df$dasy_pop_LA, na.rm = TRUE)
std_limit_education_attain_2018_LA <- sd(limit_education_attain_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_limit_education_attain_2010_DU <- mean(limit_education_attain_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_limit_education_attain_2010_DU <- sd(limit_education_attain_2010_df$dasy_pop_DU, na.rm = TRUE)

limit_education_attain_2018_df <- limit_education_attain_2018_df %>%
  mutate(z_limit_education_attain_2018_LA = (dasy_pop_LA - mean_limit_education_attain_2018_LA)/std_limit_education_attain_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
limit_education_attain_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/limit-education-attain/limit_education_attain_2018_parcel_grid_150.shp')
mean_limit_education_attain_2018_150 <- mean(limit_education_attain_2018_150$tot_pop, na.rm = TRUE)
std_limit_education_attain_2018_150 <- sd(limit_education_attain_2018_150$tot_pop, na.rm = TRUE)

limit_education_attain_2018_150 <- limit_education_attain_2018_150 %>%
  mutate(z_limit_education_attain_2018 = (tot_pop - mean_limit_education_attain_2018_150)/std_limit_education_attain_2018_150)
```

#### Male Population (#male-pop-2018)
```{r male-pop-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/male-pop")
male_pop_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/male-pop/dasy_male_pop_pb_2018.Rds')

male_pop_2018_df <- male_pop_2018$dasy_male_pop_pb_2018

mean_male_pop_2018_LA <- mean(male_pop_2018_df$dasy_pop_LA, na.rm = TRUE)
std_male_pop_2018_LA <- sd(male_pop_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_male_pop_2010_DU <- mean(male_pop_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_male_pop_2010_DU <- sd(male_pop_2010_df$dasy_pop_DU, na.rm = TRUE)

male_pop_2018_df <- male_pop_2018_df %>%
  mutate(z_male_pop_2018_LA = (dasy_pop_LA - mean_male_pop_2018_LA)/std_male_pop_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
male_pop_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/male-pop/male_pop_2018_parcel_grid_150.shp')
mean_male_2018_150 <- mean(male_pop_2018_150$tot_pop, na.rm = TRUE)
std_male_2018_150 <- sd(male_pop_2018_150$tot_pop, na.rm = TRUE)

male_pop_2018_150 <- male_pop_2018_150 %>%
  mutate(z_male_pop_2018 = (tot_pop - mean_male_2018_150)/std_male_2018_150)
```

#### Multi-family Housing (#multifamily-2010)
```{r male-pop-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/multi-family-housing")
multifamily_housing_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/multi-family-housing/dasy_multi_family_housing_pb_2018.Rds')

multifamily_housing_2018_df <- multifamily_housing_2018$dasy_multi_family_housing_pb_2018

mean_multifamily_housing_2018_LA <- mean(multifamily_housing_2018_df$dasy_pop_LA, na.rm = TRUE)
std_multifamily_housing_2018_LA <- sd(multifamily_housing_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_multifamily_housing_2010_DU <- mean(multifamily_housing_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_multifamily_housing_2010_DU <- sd(multifamily_housing_2010_df$dasy_pop_DU, na.rm = TRUE)

multifamily_housing_2018_df <- multifamily_housing_2018_df %>%
  mutate(z_multifamily_housing_2018_LA = (dasy_pop_LA - mean_multifamily_housing_2018_LA)/std_multifamily_housing_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
multifamily_housing_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/multi-family-housing/multifamily_house_2018_parcel_grid_150.shp')
mean_multifamily_housing_2018_150 <- mean(multifamily_housing_2018_150$tot_pop, na.rm = TRUE)
std_multifamily_housing_2018_150 <- sd(multifamily_housing_2018_150$tot_pop, na.rm = TRUE)

multifamily_housing_2018_150 <- multifamily_housing_2018_150 %>%
  mutate(z_multifamily_housing_2018 = (tot_pop - mean_multifamily_housing_2018_150)/std_multifamily_housing_2018_150)
```

#### Poverty (#poverty-2018)
```{r poverty-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/poverty")
poverty_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/poverty/dasy_poverty_pop_pb_2018.Rds')

poverty_2018_df <- poverty_2018$dasy_poverty_pop_pb_2018

mean_poverty_2018_LA <- mean(poverty_2018_df$dasy_pop_LA, na.rm = TRUE)
std_poverty_2018_LA <- sd(poverty_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_poverty_2010_DU <- mean(poverty_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_poverty_2010_DU <- sd(poverty_2010_df$dasy_pop_DU, na.rm = TRUE)

poverty_2018_df <- poverty_2018_df %>%
  mutate(z_poverty_2018_LA = (dasy_pop_LA - mean_poverty_2018_LA)/std_poverty_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
poverty_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/poverty/poverty_pop_2018_parcel_grid_150.shp')
mean_poverty_2018_150 <- mean(poverty_2018_150$tot_pop, na.rm = TRUE)
std_poverty_2018_150 <- sd(poverty_2018_150$tot_pop, na.rm = TRUE)

poverty_2018_150 <- poverty_2018_150 %>%
  mutate(z_poverty_2018 = (tot_pop - mean_poverty_2018_150)/std_poverty_2018_150)
```

#### Single-parent Family 2018 (#single-parent-family-2018)
```{r single-parent-family-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/single-parent-family")
single_parent_family_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/single-parent-family/dasy_single_parent_family_pb_2018.Rds')

single_parent_family_2018_df <- single_parent_family_2018$dasy_single_parent_family_pb_2018

mean_single_parent_family_2018_LA <- mean(single_parent_family_2018_df$dasy_pop_LA, na.rm = TRUE)
std_single_parent_family_2018_LA <- sd(single_parent_family_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_single_parent_family_2010_DU <- mean(single_parent_family_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_single_parent_family_2010_DU <- sd(single_parent_family_2010_df$dasy_pop_DU, na.rm = TRUE)

single_parent_family_2018_df <- single_parent_family_2018_df %>%
  mutate(z_single_parent_family_2018_LA = (dasy_pop_LA - mean_single_parent_family_2018_LA)/std_single_parent_family_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
single_parent_family_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/single-parent-family/single_parent_family_2018_parcel_grid_150.shp')
mean_single_parent_family_2018_150 <- mean(single_parent_family_2018_150$tot_pop, na.rm = TRUE)
std_single_parent_family_2018_150 <- sd(single_parent_family_2018_150$tot_pop, na.rm = TRUE)

single_parent_family_2018_150 <- single_parent_family_2018_150 %>%
  mutate(z_single_parent_family_2018 = (tot_pop - mean_single_parent_family_2018_150)/std_single_parent_family_2018_150)
```

#### Single-person Household (#single-person-household-2018)
```{r single-person-household-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/single-person-household")
single_person_household_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/single-person-household/dasy_single_person_household_pb_2018.Rds')

single_person_household_2018_df <- single_person_household_2018$dasy_single_person_household_pb_2018

mean_single_person_household_2018_LA <- mean(single_person_household_2018_df$dasy_pop_LA, na.rm = TRUE)
std_single_person_household_2018_LA <- sd(single_person_household_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_single_person_household_2010_DU <- mean(single_person_household_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_single_person_household_2010_DU <- sd(single_person_household_2010_df$dasy_pop_DU, na.rm = TRUE)

single_person_household_2018_df <- single_person_household_2018_df %>%
  mutate(z_single_person_household_2018_LA = (dasy_pop_LA - mean_single_person_household_2018_LA)/std_single_person_household_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
single_person_household_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/single-person-household/single_person_household_2018_parcel_grid_150.shp')
mean_single_person_household_2018_150 <- mean(single_person_household_2018_150$tot_pop, na.rm = TRUE)
std_single_person_household_2018_150 <- sd(single_person_household_2018_150$tot_pop, na.rm = TRUE)

single_person_household_2018_150 <- single_person_household_2018_150 %>%
  mutate(z_single_person_household_2018 = (tot_pop - mean_single_person_household_2018_150)/std_single_person_household_2018_150)
```

#### Total Household (#total-household-2018)
```{r total-household-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
# setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/total-household")
total_household_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/total-household/dasy_total_household_pb_2018.Rds')

# calculate the mean and standard deviation of the population
total_household_2018_df <- total_household_2018$dasy_total_household_pb_2018

mean_total_household_2018_LA <- mean(total_household_2018_df$dasy_pop_LA, na.rm = TRUE)
std_total_household_2018_LA <- sd(total_household_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_total_household_2010_DU <- mean(total_household_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_total_household_2010_DU <- sd(total_household_2010_df$dasy_pop_DU, na.rm = TRUE)

total_household_2018_df <- total_household_2018_df %>%
  mutate(z_total_household_2018_LA = (dasy_pop_LA - mean_total_household_2018_LA)/std_total_household_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
total_household_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/total-household/total_household_2018_parcel_grid_150.shp')
mean_total_household_2018_150 <- mean(total_household_2018_150$tot_pop, na.rm = TRUE)
std_total_household_2018_150 <- sd(total_household_2018_150$tot_pop, na.rm = TRUE)

total_household_2018_150 <- total_household_2018_150 %>%
  mutate(z_total_household_2018 = (tot_pop - mean_total_household_2018_150)/std_total_household_2018_150)
```

#### Total Housing Units (#total-housing-units-2018)
```{r total-housing-units-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/total-housing-units")
total_housing_units_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/total-housing-units/dasy_total_housing_units_pb_2018.Rds')
  
# calculate the mean and standard deviation of the population
total_housing_units_2018_df <- total_housing_units_2018$dasy_total_housing_units_pb_2018

mean_total_housing_units_2018_LA <- mean(total_housing_units_2018_df$dasy_pop_LA, na.rm = TRUE)
std_total_housing_units_2018_LA <- sd(total_housing_units_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_total_housing_units_2010_DU <- mean(total_housing_units_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_total_housing_units_2010_DU <- sd(total_housing_units_2010_df$dasy_pop_DU, na.rm = TRUE)

total_housing_units_2018_df <- total_housing_units_2018_df %>%
  mutate(z_total_housing_units_2018_LA = (dasy_pop_LA - mean_total_housing_units_2018_LA)/std_total_housing_units_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
total_housing_units_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/total-housing-units/total_housing_units_2018_parcel_grid_150.shp')
mean_total_housing_units_2018_150 <- mean(total_housing_units_2018_150$tot_pop, na.rm = TRUE)
std_total_housing_units_2018_150 <- sd(total_housing_units_2018_150$tot_pop, na.rm = TRUE)

total_housing_units_2018_150 <- total_housing_units_2018_150 %>%
  mutate(z_total_housing_units_2018 = (tot_pop - mean_total_housing_units_2018_150)/std_total_housing_units_2018_150)
```

#### White Only (#white-only-2018)
```{r white-only-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
#setwd("~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/white")
white_only_2018 <- readRDS('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/white/dasy_white_pop_pb_2018.Rds')

white_only_2018_df <- white_only_2018$dasy_white_pop_pb_2018

mean_white_only_2018_LA <- mean(white_only_2018_df$dasy_pop_LA, na.rm = TRUE)
std_white_only_2018_LA <- sd(white_only_2018_df$dasy_pop_LA, na.rm = TRUE)

#mean_white_only_2010_DU <- mean(white_only_2010_df$dasy_pop_DU, na.rm = TRUE)
#std_white_only_2010_DU <- sd(white_only_2010_df$dasy_pop_DU, na.rm = TRUE)

white_only_2018_df <- white_only_2018_df %>%
  mutate(z_white_only_2018_LA = (dasy_pop_LA - mean_white_only_2018_LA)/std_white_only_2018_LA)

#-------custoum spatial resolution (150 m)-------------------------------
white_2018_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/white/white_pop_2018_parcel_grid_150.shp')
mean_white_2018_150 <- mean(white_2018_150$tot_pop, na.rm = TRUE)
std_white_2018_150 <- sd(white_2018_150$tot_pop, na.rm = TRUE)

white_2018_150 <- white_2018_150 %>%
  mutate(z_white_2018 = (tot_pop - mean_white_2018_150)/std_white_2018_150)
```

### Fire Station (#fire-station)
```{r fire-station,  include = FALSE, message = FALSE, warning = FALSE}
#-------custoum spatial resolution (150 m)--------------------
fire_station_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/fire_station/fire_station_grid_150.shp')
mean_fire_station_150 <- mean(fire_station_150$tot_pop, na.rm = TRUE)
std_fire_station_150 <- sd(fire_station_150$tot_pop, na.rm = TRUE)

fire_station_150 <- fire_station_150 %>%
  mutate(z_fire_station_2018 = (tot_pop - mean_fire_station_150)/std_fire_station_150)
```

### Grocery Stores (#grocery)
```{r grocery-stores,  include = FALSE, message = FALSE, warning = FALSE}
#-------custoum spatial resolution (150 m)--------------------
grocery_stores_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/grocery_stores/grocery_stores_grid_150.shp')
mean_grocery_stores_150 <- mean(grocery_stores_150$tot_pop, na.rm = TRUE)
std_grocery_stores_150 <- sd(grocery_stores_150$tot_pop, na.rm = TRUE)

grocery_stores_150 <- grocery_stores_150 %>%
  mutate(z_grocery_stores_2018 = (tot_pop - mean_grocery_stores_150)/std_grocery_stores_150)
```

### Super Market (#supermarket)
```{r supermarket, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
supermarket_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/supermarket/supermarket_grid_150.shp')
mean_supermarket_150 <- mean(supermarket_150$tot_pop, na.rm = TRUE)
std_supermarket_150 <- sd(supermarket_150$tot_pop, na.rm = TRUE)

supermarket_150 <- supermarket_150 %>%
  mutate(z_supermarket_2018 = (tot_pop - mean_supermarket_150)/std_supermarket_150)
```

### Emergency Rooms (#emergency)
```{r emergency, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
emergency_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/emergency_rooms/emergency_grid_150.shp')
mean_emergency_150 <- mean(emergency_150$tot_pop, na.rm = TRUE)
std_emergency_150 <- sd(emergency_150$tot_pop, na.rm = TRUE)

emergency_150 <- emergency_150 %>%
  mutate(z_emergency_2018 = (tot_pop - mean_emergency_150)/std_emergency_150)
```

### Healthcare (#healthcare)
```{r healthcare, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
healthcare_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/healthcare/healthcare_grid_150.shp')
mean_healthcare_150 <- mean(healthcare_150$tot_pop, na.rm = TRUE)
std_healthcare_150 <- sd(healthcare_150$tot_pop, na.rm = TRUE)

healthcare_150 <- healthcare_150 %>%
  mutate(z_healthcare_2018 = (tot_pop - mean_healthcare_150)/std_healthcare_150)
```

### Hospitals (#hospital)
```{r hospital, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
hospital_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/hospitals/hospital_grid_150.shp')
mean_hospital_150 <- mean(hospital_150$tot_pop, na.rm = TRUE)
std_hospital_150 <- sd(hospital_150$tot_pop, na.rm = TRUE)

hospital_150 <- hospital_150 %>%
  mutate(z_hospital_2018 = (tot_pop - mean_hospital_150)/std_hospital_150)
```

### Denominations (#denominations)
```{r denominations, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
denomination_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/denominations/denomination_grid_150.shp')
mean_denomination_150 <- mean(denomination_150$tot_pop, na.rm = TRUE)
std_denomination_150 <- sd(denomination_150$tot_pop, na.rm = TRUE)

denomination_150 <- denomination_150 %>%
  mutate(z_denomination_2018 = (tot_pop - mean_denomination_150)/std_denomination_150)
```

### Places Worship (#Worship)
```{r worship, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
worship_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/places_worship/worship_grid_150.shp')
mean_worship_150 <- mean(worship_150$tot_pop, na.rm = TRUE)
std_worship_150 <- sd(worship_150$tot_pop, na.rm = TRUE)

worship_150 <- worship_150 %>%
  mutate(z_worship_2018 = (tot_pop - mean_worship_150)/std_worship_150)
```

### Religion (#religion)
```{r religion, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
religion_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/religion/religion_grid_150.shp')
mean_religion_150 <- mean(religion_150$tot_pop, na.rm = TRUE)
std_religion_150 <- sd(religion_150$tot_pop, na.rm = TRUE)

religion_150 <- religion_150 %>%
  mutate(z_religion_2018 = (tot_pop - mean_religion_150)/std_religion_150)
```

### College (#college)
```{r college, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
college_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/college/college_grid_150.shp')
mean_college_150 <- mean(college_150$tot_pop, na.rm = TRUE)
std_college_150 <- sd(college_150$tot_pop, na.rm = TRUE)

college_150 <- college_150 %>%
  mutate(z_college_2018 = (tot_pop - mean_college_150)/std_college_150)
```

### kindergarten (#kindergarten)
```{r kindergarten, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
kindergarten_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/kindergarten/kindergarten_grid_150.shp')
mean_kindergarten_150 <- mean(kindergarten_150$tot_pop, na.rm = TRUE)
std_kindergarten_150 <- sd(kindergarten_150$tot_pop, na.rm = TRUE)

kindergarten_150 <- kindergarten_150 %>%
  mutate(z_kindergarten_2018 = (tot_pop - mean_kindergarten_150)/std_kindergarten_150)
```

### libraries (#libraries)
```{r libraries, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
libraries_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/libraries/libraries_grid_150.shp')
mean_libraries_150 <- mean(libraries_150$tot_pop, na.rm = TRUE)
std_libraries_150 <- sd(libraries_150$tot_pop, na.rm = TRUE)

libraries_150 <- libraries_150 %>%
  mutate(z_libraries_2018 = (tot_pop - mean_libraries_150)/std_libraries_150)
```

### private school (#private-schools)
```{r public, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
private_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/private_school/private_school_grid_150.shp')
mean_private_150 <- mean(private_150$tot_pop, na.rm = TRUE)
std_private_150 <- sd(private_150$tot_pop, na.rm = TRUE)

private_150 <- private_150 %>%
  mutate(z_private_2018 = (tot_pop - mean_private_150)/std_private_150)
```

### public school (#public-schools)
```{r public, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
public_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/public_school/public_school_grid_150.shp')
mean_public_150 <- mean(public_150$tot_pop, na.rm = TRUE)
std_public_150 <- sd(public_150$tot_pop, na.rm = TRUE)

public_150 <- public_150 %>%
  mutate(z_public_2018 = (tot_pop - mean_public_150)/std_public_150)
```

### K-12 school (#k-12)
```{r school, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
school_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/K-12_school/k-12_school_grid_150.shp')
mean_school_150 <- mean(school_150$tot_pop, na.rm = TRUE)
std_school_150 <- sd(school_150$tot_pop, na.rm = TRUE)

school_150 <- school_150 %>%
  mutate(z_school_2018 = (tot_pop - mean_school_150)/std_school_150)
```

### University (#university)
```{r university, include=FALSE, message=FALSE, warning=FALSE}
#-------custoum spatial resolution (150 m)--------------------
university_150 <- st_read('~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150/university/university_grid_150.shp')
mean_university_150 <- mean(university_150$tot_pop, na.rm = TRUE)
std_university_150 <- sd(university_150$tot_pop, na.rm = TRUE)

university_150 <- university_150 %>%
  mutate(z_university_2018 = (tot_pop - mean_university_150)/std_university_150)
```


## Build the variables dataframe (#build-df-2018)

Here, we incorporate all the variables and build the dataframe which contains all the variable's z score, geometry information in one dataframe, preparing for principal component analysis. Variables information are sourced from those listed dataframes: (1) population; (2) male population; (3) female population; (4) disable population; (5) african american population; (6) hispanic population; (7) white population; (8) poverty population; (9) limit education attain population; (10) single parent family; (11) single person household; (12) household with senior; (13) multifamily housing units; (14) total housing units; (15) total household; (16) single parent family

```{r build-variable-df-2018, include=FALSE, message=FALSE, warning=FALSE}
# year of 2018
variable_df_2018_LA <- population_2018_df %>% dplyr::select ("BLDG_ID","GEOID", "z_pop_2018_LA" ) %>% st_drop_geometry() %>%
  left_join(white_only_2018_df %>% dplyr::select("BLDG_ID", "z_white_only_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(male_pop_2018_df %>% dplyr::select("BLDG_ID", "z_male_pop_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(female_pop_2018_df %>% dplyr::select("BLDG_ID", "z_female_pop_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID")%>%
  left_join(disable_pop_2018_df %>% dplyr::select("BLDG_ID", "z_disable_pop_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID")%>%
  left_join(african_american_2018_df %>% dplyr::select("BLDG_ID", "z_african_american_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID")%>%
  left_join(hispanic_2018_df %>% dplyr::select("BLDG_ID", "z_hispanic_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID")%>%
  left_join(family_own_children_2018_df %>% dplyr::select("BLDG_ID", "z_family_own_children_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(total_household_2018_df %>% dplyr:: select("BLDG_ID", "z_total_household_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(single_parent_family_2018_df %>% dplyr::select("BLDG_ID", "z_single_parent_family_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(total_housing_units_2018_df %>% dplyr::select("BLDG_ID", "z_total_housing_units_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(single_person_household_2018_df %>% dplyr::select("BLDG_ID", "z_single_person_household_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(multifamily_housing_2018_df %>% dplyr::select("BLDG_ID", "z_multifamily_housing_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(household_senior_2018_df %>% dplyr::select("BLDG_ID", "z_household_senior_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(poverty_2018_df %>% dplyr::select("BLDG_ID", "z_poverty_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID") %>%
  left_join(limit_education_attain_2018_df %>% dplyr::select("BLDG_ID", "z_limit_education_attain_2018_LA") %>% st_drop_geometry(), by = "BLDG_ID")
#---------------------------------custoum spatial resolution (150 m)--------------------------------
variable_df_2018_150 <- population_2018_150 %>% dplyr::select ("grid_id", "z_pop_2018" ) %>%
  left_join(white_2018_150 %>% dplyr::select("grid_id", "z_white_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(male_pop_2018_150 %>% dplyr::select("grid_id", "z_male_pop_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(female_2018_150 %>% dplyr::select("grid_id", "z_female_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(disable_2018_150 %>% dplyr::select("grid_id", "z_disable_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(black_2018_150 %>% dplyr::select("grid_id", "z_black_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(hispanic_2018_150 %>% dplyr::select("grid_id", "z_hispanic_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(family_own_children_2018_150 %>% dplyr::select("grid_id", "z_family_own_children_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(total_household_2018_150 %>% dplyr:: select("grid_id", "z_total_household_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(single_parent_family_2018_150 %>% dplyr::select("grid_id", "z_single_parent_family_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(total_housing_units_2018_150 %>% dplyr::select("grid_id", "z_total_housing_units_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(single_person_household_2018_150 %>% dplyr::select("grid_id", "z_single_person_household_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(multifamily_housing_2018_150 %>% dplyr::select("grid_id", "z_multifamily_housing_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(household_senior_2018_150 %>% dplyr::select("grid_id", "z_household_senior_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(poverty_2018_150 %>% dplyr::select("grid_id", "z_poverty_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(limit_education_attain_2018_150 %>% dplyr::select("grid_id", "z_limit_education_attain_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(fire_station_150 %>% dplyr::select("grid_id", "z_fire_station_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(grocery_stores_150 %>% dplyr::select("grid_id", "z_grocery_stores_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(supermarket_150 %>% dplyr::select("grid_id", "z_supermarket_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(emergency_150 %>% dplyr::select("grid_id", "z_emergency_2018") %>% st_drop_geometry(), by = "grid_id")  %>%
  left_join(healthcare_150 %>% dplyr::select("grid_id", "z_healthcare_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(hospital_150 %>% dplyr::select("grid_id", "z_hospital_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(denomination_150 %>% dplyr::select("grid_id", "z_denomination_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(worship_150 %>% dplyr::select("grid_id", "z_worship_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(religion_150 %>% dplyr::select("grid_id", "z_religion_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(college_150 %>% dplyr::select("grid_id", "z_college_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(kindergarten_150 %>% dplyr::select("grid_id", "z_kindergarten_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(libraries_150 %>% dplyr::select("grid_id", "z_libraries_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(public_150 %>% dplyr::select("grid_id", "z_public_2018") %>% st_drop_geometry(), by = "grid_id")%>%
  left_join(private_150 %>% dplyr::select("grid_id", "z_private_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(school_150 %>% dplyr::select("grid_id", "z_school_2018") %>% st_drop_geometry(), by = "grid_id") %>%
  left_join(university_150 %>% dplyr::select("grid_id", "z_university_2018") %>% st_drop_geometry(), by = "grid_id")
```

## Perform the principal component analysis (#pca)

Here, based on the variables dataframe, the principal component analysis (PCA) is performed to reduce the dimension of the variables dataframe. Kaiser criterion is used for component selection, and this can be aided by the examination of a scree plot.
```{r pca, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
variable_df_2010_LA[variable_df_2010_LA == "NaN"] = NA
variable_df_2010_LA <- na.omit(variable_df_2010_LA)

variable_df_2010_DU[variable_df_2010_DU == "NaN"] = NA
variable_df_2010_DU <- na.omit(variable_df_2010_DU)

# year of 2018
variable_df_2018_LA <- na.omit(variable_df_2018_LA)


# year of 2010
variable_pca_2010_LA <- prcomp(variable_df_2010_LA %>% dplyr::select(-"STANPAR", -"GEOID"), center = TRUE, scale. = TRUE) 
summary(variable_pca_2010_LA)

variable_pca_2010_DU <- prcomp(variable_df_2010_DU %>% dplyr::select(-"STANPAR", -"GEOID"), center = TRUE, scale. = TRUE) 
summary(variable_pca_2010_DU)

# year of 2018
variable_pca_2018_LA <- prcomp(variable_df_2018_LA %>% dplyr::select(-"BLDG_ID", -"GEOID"), center = TRUE, scale. = TRUE) 
summary(variable_pca_2018_LA)
#---------------------------------custoum spatial resolution (150 m)--------------------------------
variable_pca_2018_150 <- prcomp(variable_df_2018_150 %>% dplyr::select(-"grid_id") %>% st_drop_geometry(), center = TRUE, scale. = TRUE) 
summary(variable_pca_2018_150)

# plot the PCA chart
# screeplot(variable_pca, npcs = length(variable_pca$sdev), type = "lines")

pcaCharts <- function(x) {
    x.var <- x$sdev ^ 2
    x.pvar <- x.var/sum(x.var)
    print("proportions of variance:")
    print(x.pvar)
    
    par(mfrow=c(2,2))
    plot(x.pvar,xlab="Principal component", ylab="Proportion of variance explained", ylim=c(0,1), type='b')
    plot(cumsum(x.pvar),xlab="Principal component", ylab="Cumulative Proportion of variance explained", ylim=c(0,1), type='b')
    screeplot(x)
    screeplot(x,type="l")
    par(mfrow=c(1,1))
}


# year of 2010
pcaCharts(variable_pca_2010_LA)
pcaCharts(variable_pca_2010_DU)

# Plot the biplot

library(devtools)
install_github("vqv/ggbiplot")
library(ggbiplot)

# year of 2010
ggbiplot(variable_pca_2010_LA)
ggbiplot(variable_pca_2010_DU)

```

## Calculate the social fabric scores (#calc-score)

Here, we calculate the social fabric scores based on the previous results of principal component analysis. For example, we choose the first 4 components to calculate the social fabric score.

```{r calc-score, include=FALSE, message=FALSE, warning=FALSE}
# Year of 2010
variable_df_pca_2010_LA <- variable_df_2010_LA %>% dplyr::select("STANPAR") %>%
 cbind(data.frame(variable_pca_2010_LA$x) %>% dplyr::select(PC1, PC2, PC3, PC4))

variable_df_pca_2010_DU <- variable_df_2010_DU %>% dplyr::select("STANPAR") %>%
 cbind(data.frame(variable_pca_2010_DU$x) %>% dplyr::select(PC1, PC2, PC3, PC4))

pca_component_loading_2010_LA <- data.frame(variable_pca_2010_LA$rotation) %>%
  rownames_to_column("variable")

#---------------------------------custoum spatial resolution (150 m)--------------------------------
variable_df_pca_2018_150 <- variable_df_2018_150 %>% dplyr::select("grid_id") %>%
 cbind(data.frame(variable_pca_2018_150$x) %>% dplyr::select(PC1, PC2, PC3, PC4))


# show the component loadings table
pca_component_loading_2010_LA %>%
gt() %>%
  tab_header(title =md ("**Component Loadings**")) %>%
  cols_label(variable = md("**Variable**"),PC1 = md("**PC1**"), PC2 = md("**PC2**"),  PC3 = md("**PC3**"), PC4 = md("**PC4**"), PC5 = md("**PC5**"), PC6 = md("**PC6**"), PC7 =  md("**PC7**"), PC8 = md("**PC8**"), PC9 =  md("**PC9**"), PC10 = md("**PC10**"), PC11 = md("**PC11**"), PC12 = md("**PC12**"), PC13 = md("**PC13**"))

# Year of 2018
variable_df_pca_2018_LA <- variable_df_2018_LA %>% dplyr::select("BLDG_ID") %>%
 cbind(data.frame(variable_pca_2018_LA$x) %>% dplyr::select(PC1, PC2, PC3, PC4))

```

### Mapping the social fabric score/index (#map-score)

score = PC1 + PC2 + PC3 + PC4
```{r map-score-2010, include=FALSE, message=FALSE, warning=FALSE}
# year of 2010
variable_df_pca_2010_LA <- variable_df_pca_2010_LA %>%
  mutate(score = PC1 + PC2 + PC3 + PC4) %>% left_join(population_2010_df %>% dplyr::select(STANPAR, GEOID), by = "STANPAR")

st_write(variable_df_pca_2010_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric", layer = "2010_parcel_dasy_sfs_LA",
         driver = "ESRI Shapefile" )

write_rds(list(variable_df_pca_2010_LA = variable_df_pca_2010_LA),
          path = file.path(data_dir ="~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric", "dasy_parcel_sfs_2010_LA.Rds"))

#----------------------------------------------------------------------------------------------------------------------------------
variable_df_pca_2010_DU <- variable_df_pca_2010_DU %>%
  mutate(score = PC1 + PC2 + PC3 + PC4) %>% left_join(population_2010_df %>% dplyr::select(STANPAR, GEOID), by = "STANPAR")

st_write(variable_df_pca_2010_DU, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric", layer = "2010_parcel_dasy_sfs_DU",
         driver = "ESRI Shapefile" )

write_rds(list(variable_df_pca_2010_DU = variable_df_pca_2010_DU),
          path = file.path(data_dir ="~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric", "dasy_parcel_sfs_2010_DU.Rds"))

#----------------------------------------------------------------------------------------------------------------------------------
# year of 2018
variable_df_pca_2018_LA <- variable_df_pca_2018_LA %>%
  mutate(score = PC1 + PC2 + PC3 + PC4) %>% left_join(population_2018_df %>% dplyr::select(BLDG_ID, GEOID), by = "BLDG_ID")

st_write(variable_df_pca_2018_LA, dsn = "~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric", layer = "2018_parcel_dasy_sfs_LA",
         driver = "ESRI Shapefile" )

write_rds(list(variable_df_pca_2018_LA = variable_df_pca_2018_LA),
          path = file.path(data_dir ="~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric", "dasy_parcel_sfs_2018_LA.Rds"))
#---------------------------------custoum spatial resolution (150 m)--------------------------------
variable_df_pca_2018_150 <- variable_df_pca_2018_150 %>%
  mutate(score = PC1 + PC2 + PC3 + PC4) 

plot(variable_df_pca_2018_150 %>% dplyr::select(-PC1, -PC2, -PC3, -PC4, -grid_id))
st_write(variable_df_pca_2018_150, dsn = "~/Desktop/MarTREC_project/Data/2018_Data/2018_parcel_dasymetric/2018_parcel_grid_150", layer = "2018_sfs_parcel_dasymetric_150",
         driver = "ESRI Shapefile" )
```

## Plot the tax-parcel based social fabric score of census tracts of interests (#ct-interest)
Here, we plot social fabric score of several census tracts that of interests (with many homes been bought out since the 2010 flood). (1) census tract 106.02 (fewer homes been bought out) and census tract 107.01 (many homes been bought out); (2) census tract 153 (many homes been bought out) and census tract 106.01 (fewer homes been bought out); (3) census tract 133 (many homes been bought out) and census tract 134 (fewer homes been bought out).

```{r sfs-ct-interests, include = FALSE, message = FALSE, warning = FALSE}

ct_sfs_106_02_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037010602)
st_write(ct_sfs_106_02_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_106_02", layer = "2010_parcel_dasy_sfs_ct_106_02_LA",
         driver = "ESRI Shapefile" )

ct_sfs_107_01_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037010701)
st_write(ct_sfs_107_01_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_107_01", layer = "2010_parcel_dasy_sfs_ct_107_01_LA",
         driver = "ESRI Shapefile" )

ct_sfs_153_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037015300)
st_write(ct_sfs_153_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_153", layer = "2010_parcel_dasy_sfs_ct_153_LA",
         driver = "ESRI Shapefile" )

ct_sfs_106_01_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037010601)
st_write(ct_sfs_106_01_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_106_01", layer = "2010_parcel_dasy_sfs_ct_106_01_LA",
         driver = "ESRI Shapefile" )

ct_sfs_133_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037013300)
st_write(ct_sfs_133_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_133", layer = "2010_parcel_dasy_sfs_ct_133_LA",
         driver = "ESRI Shapefile" )

ct_sfs_134_LA <- variable_df_pca_2010_LA %>% filter(GEOID == 47037013400)
st_write(ct_sfs_134_LA, dsn = "~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract/ct_134", layer = "2010_parcel_dasy_sfs_ct_134_LA",
         driver = "ESRI Shapefile" )

write_rds(list(ct_sfs_106_02_LA = ct_sfs_106_02_LA, ct_sfs_107_01_LA = ct_sfs_107_01_LA, ct_sfs_153_LA = ct_sfs_153_LA, ct_sfs_106_01_LA = ct_sfs_106_01_LA, ct_sfs_133_LA = ct_sfs_133_LA, ct_sfs_134_LA = ct_sfs_134_LA),path = file.path(data_dir ="~/Desktop/MarTREC_project/Data/2010_Data/2010_parcel_dasymetric/social-fabric-score/census_tract", "dasy_tax_sfs_ct_2010_LA.Rds"))


```


















